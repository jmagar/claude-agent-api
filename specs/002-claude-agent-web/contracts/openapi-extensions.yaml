openapi: 3.1.0
info:
  title: Claude Agent API - Frontend Extensions
  description: |
    Extensions to the Claude Agent API to support frontend web interface features.
    These endpoints supplement the core streaming API documented in specs/001-claude-agent-api/contracts/openapi.yaml.
  version: 1.0.0

servers:
  - url: http://localhost:54000/api/v1
    description: Local development server

paths:
  # ============================================================================
  # PROJECT MANAGEMENT (Code Mode)
  # ============================================================================

  /projects:
    get:
      summary: List all projects
      description: Get a list of all projects available for Code mode sessions
      tags:
        - Projects
      security:
        - ApiKeyAuth: []
      parameters:
        - name: sort
          in: query
          schema:
            type: string
            enum: [name, created_at, last_accessed_at]
            default: last_accessed_at
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                type: object
                properties:
                  projects:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
                  total:
                    type: integer

    post:
      summary: Create a new project
      description: Create a new project directory for Code mode
      tags:
        - Projects
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  description: Project name (used as directory name if path not provided)
                path:
                  type: string
                  description: Optional custom path relative to WORKSPACE_BASE_DIR
                metadata:
                  type: object
                  additionalProperties: true
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Project with this name or path already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{id}:
    get:
      summary: Get project details
      tags:
        - Projects
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      summary: Update project
      tags:
        - Projects
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                metadata:
                  type: object
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

    delete:
      summary: Delete project
      tags:
        - Projects
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Project deleted successfully

  # ============================================================================
  # AGENT MANAGEMENT
  # ============================================================================

  /agents:
    get:
      summary: List all agent definitions
      tags:
        - Agents
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentDefinition'

    post:
      summary: Create a new agent
      tags:
        - Agents
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - prompt
              properties:
                name:
                  type: string
                description:
                  type: string
                prompt:
                  type: string
                tools:
                  type: array
                  items:
                    type: string
                model:
                  type: string
                  enum: [sonnet, opus, haiku, inherit]
      responses:
        '201':
          description: Agent created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentDefinition'

  /agents/{id}:
    get:
      summary: Get agent details
      tags:
        - Agents
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentDefinition'

    put:
      summary: Update agent
      tags:
        - Agents
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentDefinition'
      responses:
        '200':
          description: Agent updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentDefinition'

    delete:
      summary: Delete agent
      tags:
        - Agents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      security:
        - ApiKeyAuth: []
      responses:
        '204':
          description: Agent deleted

  /agents/{id}/share:
    post:
      summary: Generate shareable link for agent
      tags:
        - Agents
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Share link generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  share_url:
                    type: string
                    format: uri
                  share_token:
                    type: string

  # ============================================================================
  # SKILL MANAGEMENT
  # ============================================================================

  /skills:
    get:
      summary: List all skills
      tags:
        - Skills
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of skills
          content:
            application/json:
              schema:
                type: object
                properties:
                  skills:
                    type: array
                    items:
                      $ref: '#/components/schemas/SkillDefinition'

    post:
      summary: Create a new skill
      tags:
        - Skills
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - content
              properties:
                name:
                  type: string
                description:
                  type: string
                content:
                  type: string
                  description: Markdown content
      responses:
        '201':
          description: Skill created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillDefinition'

  /skills/{id}:
    get:
      summary: Get skill details
      tags:
        - Skills
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Skill details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillDefinition'

    put:
      summary: Update skill
      tags:
        - Skills
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SkillDefinition'
      responses:
        '200':
          description: Skill updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SkillDefinition'

    delete:
      summary: Delete skill
      tags:
        - Skills
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Skill deleted

  # ============================================================================
  # SLASH COMMAND MANAGEMENT
  # ============================================================================

  /slash-commands:
    get:
      summary: List all slash commands
      tags:
        - Slash Commands
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of slash commands
          content:
            application/json:
              schema:
                type: object
                properties:
                  commands:
                    type: array
                    items:
                      $ref: '#/components/schemas/SlashCommandDefinition'

    post:
      summary: Create a new slash command
      tags:
        - Slash Commands
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - content
              properties:
                name:
                  type: string
                description:
                  type: string
                content:
                  type: string
                  description: Markdown content with YAML frontmatter
      responses:
        '201':
          description: Slash command created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlashCommandDefinition'

  /slash-commands/{id}:
    get:
      summary: Get slash command details
      tags:
        - Slash Commands
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Slash command details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlashCommandDefinition'

    put:
      summary: Update slash command
      tags:
        - Slash Commands
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlashCommandDefinition'
      responses:
        '200':
          description: Slash command updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlashCommandDefinition'

    delete:
      summary: Delete slash command
      tags:
        - Slash Commands
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Slash command deleted

  # ============================================================================
  # TOOL PRESET MANAGEMENT
  # ============================================================================

  /tool-presets:
    get:
      summary: List all tool presets
      tags:
        - Tool Presets
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of tool presets
          content:
            application/json:
              schema:
                type: object
                properties:
                  presets:
                    type: array
                    items:
                      $ref: '#/components/schemas/ToolPreset'

    post:
      summary: Create a new tool preset
      tags:
        - Tool Presets
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - tools
              properties:
                name:
                  type: string
                description:
                  type: string
                tools:
                  type: array
                  items:
                    type: string
                is_default:
                  type: boolean
      responses:
        '201':
          description: Tool preset created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolPreset'

  /tool-presets/{id}:
    get:
      summary: Get tool preset details
      tags:
        - Tool Presets
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Tool preset details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolPreset'

    put:
      summary: Update tool preset
      tags:
        - Tool Presets
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToolPreset'
      responses:
        '200':
          description: Tool preset updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolPreset'

    delete:
      summary: Delete tool preset
      tags:
        - Tool Presets
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Tool preset deleted

  # ============================================================================
  # MCP SERVER MANAGEMENT
  # ============================================================================

  /mcp-servers:
    get:
      summary: List all MCP server configurations
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: List of MCP server configurations
          content:
            application/json:
              schema:
                type: object
                properties:
                  servers:
                    type: array
                    items:
                      $ref: '#/components/schemas/McpServerConfig'

    post:
      summary: Create a new MCP server configuration
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - config
              properties:
                name:
                  type: string
                  description: Unique server identifier
                type:
                  type: string
                  enum: [stdio, sse, http]
                  description: Connection type
                config:
                  type: object
                  description: Server-specific configuration (command, args, url, headers, env)
                  additionalProperties: true
      responses:
        '201':
          description: MCP server configuration created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServerConfig'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: MCP server with this name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /mcp-servers/{name}:
    get:
      summary: Get MCP server configuration details
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Server name identifier
      responses:
        '200':
          description: MCP server configuration details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServerConfig'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: Update MCP server configuration
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Server name identifier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [stdio, sse, http]
                config:
                  type: object
                  additionalProperties: true
                is_shared:
                  type: boolean
      responses:
        '200':
          description: MCP server configuration updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/McpServerConfig'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Delete MCP server configuration
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Server name identifier
      responses:
        '204':
          description: MCP server configuration deleted successfully

  /mcp-servers/{name}/resources:
    get:
      summary: List resources provided by MCP server
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Server name identifier
      responses:
        '200':
          description: List of resources
          content:
            application/json:
              schema:
                type: object
                properties:
                  resources:
                    type: array
                    items:
                      type: object
                      properties:
                        uri:
                          type: string
                        name:
                          type: string
                        description:
                          type: string
                        mimeType:
                          type: string

  /mcp-servers/{name}/resources/{uri}:
    get:
      summary: Read specific resource from MCP server
      tags:
        - MCP Servers
      security:
        - ApiKeyAuth: []
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          description: Server name identifier
        - name: uri
          in: path
          required: true
          schema:
            type: string
          description: Resource URI
      responses:
        '200':
          description: Resource content
          content:
            application/json:
              schema:
                type: object
                properties:
                  uri:
                    type: string
                  mimeType:
                    type: string
                  text:
                    type: string

  # ============================================================================
  # SESSION ENHANCEMENTS
  # ============================================================================

  /sessions:
    get:
      summary: List sessions with filtering
      tags:
        - Sessions
      security:
        - ApiKeyAuth: []
      parameters:
        - name: mode
          in: query
          schema:
            type: string
            enum: [brainstorm, code]
        - name: project_id
          in: query
          schema:
            type: string
            format: uuid
        - name: tags
          in: query
          schema:
            type: array
            items:
              type: string
        - name: search
          in: query
          schema:
            type: string
          description: Search in session titles and messages
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
      responses:
        '200':
          description: List of sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
                    items:
                      $ref: '#/components/schemas/SessionWithMeta'
                  total:
                    type: integer
                  page:
                    type: integer
                  page_size:
                    type: integer

  /sessions/{id}/tags:
    patch:
      summary: Update session tags
      tags:
        - Sessions
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tags
              properties:
                tags:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Tags updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionWithMeta'

  /sessions/{id}/promote:
    post:
      summary: Promote Brainstorm session to Code mode
      tags:
        - Sessions
      security:
        - ApiKeyAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - project_id
              properties:
                project_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Session promoted to Code mode
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionWithMeta'

# ============================================================================
# COMPONENTS
# ============================================================================

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    Project:
      type: object
      required:
        - id
        - name
        - path
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        path:
          type: string
          description: Path relative to WORKSPACE_BASE_DIR
        created_at:
          type: string
          format: date-time
        last_accessed_at:
          type: string
          format: date-time
        session_count:
          type: integer
        metadata:
          type: object
          additionalProperties: true

    AgentDefinition:
      type: object
      required:
        - id
        - name
        - description
        - prompt
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        prompt:
          type: string
        tools:
          type: array
          items:
            type: string
        model:
          type: string
          enum: [sonnet, opus, haiku, inherit]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        is_shared:
          type: boolean
        share_url:
          type: string
          format: uri

    SkillDefinition:
      type: object
      required:
        - id
        - name
        - description
        - content
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        content:
          type: string
          description: Markdown content with YAML frontmatter
        enabled:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        is_shared:
          type: boolean
        share_url:
          type: string
          format: uri

    SlashCommandDefinition:
      type: object
      required:
        - id
        - name
        - description
        - content
        - enabled
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          description: Command name (without slash prefix)
        description:
          type: string
        content:
          type: string
          description: Markdown content with YAML frontmatter
        enabled:
          type: boolean
          default: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ToolPreset:
      type: object
      required:
        - id
        - name
        - allowed_tools
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        allowed_tools:
          type: array
          items:
            type: string
          description: Array of tool names to allow
        disallowed_tools:
          type: array
          items:
            type: string
          default: []
          description: Array of tool names to disallow
        is_system:
          type: boolean
          default: false
          description: Whether this is a built-in system preset
        created_at:
          type: string
          format: date-time

    McpServerConfig:
      type: object
      required:
        - id
        - name
        - transport_type
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          description: Unique server identifier
        transport_type:
          type: string
          enum: [stdio, sse, http]
          description: Connection type (stdio for local process, sse/http for remote)
        command:
          type: string
          description: Command to execute (stdio only)
        args:
          type: array
          items:
            type: string
          description: Command arguments (stdio only)
        url:
          type: string
          format: uri
          description: Remote server URL (sse/http only)
        headers:
          type: object
          additionalProperties:
            type: string
          description: HTTP headers for remote connections
        env:
          type: object
          additionalProperties:
            type: string
          description: Environment variables with ${VAR:-default} support
        enabled:
          type: boolean
          default: true
          description: Whether server is enabled
        status:
          type: string
          enum: [active, failed, disabled]
          description: Server connection status
        error:
          type: string
          description: Error message if status is 'failed'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true

    SessionWithMeta:
      allOf:
        - type: object
          required:
            - id
            - mode
            - status
            - created_at
          properties:
            id:
              type: string
              format: uuid
            mode:
              type: string
              enum: [brainstorm, code]
            status:
              type: string
              enum: [active, completed, error]
            project_id:
              type: string
              format: uuid
            title:
              type: string
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
            last_message_at:
              type: string
              format: date-time
            total_turns:
              type: integer
            total_cost_usd:
              type: number
              format: float
            parent_session_id:
              type: string
              format: uuid
            tags:
              type: array
              items:
                type: string
            duration_ms:
              type: integer
              description: Query execution time in milliseconds
            usage:
              type: object
              description: Aggregate token usage
              properties:
                input_tokens:
                  type: integer
                output_tokens:
                  type: integer
                cache_creation_input_tokens:
                  type: integer
                cache_read_input_tokens:
                  type: integer
            model_usage:
              type: object
              description: Per-model token breakdown
              additionalProperties:
                type: object
                properties:
                  input_tokens:
                    type: integer
                  output_tokens:
                    type: integer
                  cache_creation_input_tokens:
                    type: integer
                  cache_read_input_tokens:
                    type: integer
            metadata:
              type: object
              additionalProperties: true

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
